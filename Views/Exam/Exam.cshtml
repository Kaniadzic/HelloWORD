@{
    ViewBag.Title = "Exam";
}

<main class="mb-5">
    <section class="d-flex align-items-center justify-content-between exam-top-panel mb-3">
        <div class="ml-md-5 exam-top-text">
            Kategoria: <span class="mr-3 HelloWORD" id="examCategory">@ViewBag.Category</span>
            Wartość punktowa: <span class="mr-3" id="examScore">X</span>
            Czas do końca: <span class="mr-3" id="examTime">mm:ss</span>
        </div>
        <div class="mr-md-5">
            <button class="btn btn-danger">Zakończ</button>
        </div>
    </section>
    <section class="d-md-flex align-items-start justify-content-center">
        <div class="d-flex flex-column justify-content-around mr-3">
            <div class="exam-media d-flex align-items-center justify-content-center">
                <img src="~/Content/images/placeholder.jpg" alt="To pytanie nie ma obrazka" class="exam-picture">
            </div>
            <div class="exam-question my-3">
                lorem ipsum
            </div>
            <div class="exam-answers d-flex justify-content-around">
                <button class="exam-answer-traffic my-2 d-flex align-items-center justify-content-center" id="AnswerYes" value="true">Tak</button>
                <button class="exam-answer-traffic my-2 d-flex align-items-center justify-content-center" id="AnswerNo" value="false">Nie</button>

                @*<div class="exam-answer-categorized my-2 d-flex align-items-center pl-2" id="AnswerA">A</div>
                <div class="exam-answer-categorized my-2 d-flex align-items-center pl-2" id="AnswerB">B</div>
                <div class="exam-answer-categorized my-2 d-flex align-items-center pl-2" id="AnswerC">C</div>*@
            </div>
        </div>

        <div class="d-flex flex-column exam-info-panel align-items-center justify-content-center mt-5 ml-3">
            <p class="h5">Postęp części podstawowej: <span id="trafficProgress">0</span>/20</p>
            <p class="h5">Postęp części specjalistycznej: <span id="categorizedProgress">0</span>/12</p>

            <p id="questionTimer" class="mt-5">Czas na zapoznanie się z pytaniem</p>
            <div class="loadbar d-flex justify-content-start">
                <div id="loadbarProgress"></div>
                <div id="loadbarText">XX</div>
            </div>

            <div class="d-flex mt-5">
                <button class="btn btn-warning mr-4">START</button>
                <button class="btn btn-success ml-4">DALEJ</button>
            </div>
        </div>
    </section>
</main>

<script type="text/javascript" src="~/Scripts/jquery-3.4.1.min.js"></script>

<script>
    // zmienne z pytaniami(array) i kategorią
    let trafficQuestions;
    let categorizedQuestions;
    let category = '@ViewBag.Category';

    // zmienne do śledzenia stanu egzaminu
    let categorizedPhase = 0;
    let trafficQuestionCounter = 0;
    let categorizedQuestionCounter = 0;

    // pobranie list z pytaniami i start egzaminu
    $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("GenerateTrafficQuestions")',
            cache: false,
            dataType: "JSON",
            success: function (data) {
                initializeTrafficQuestions(data);
            }
        });

        $.ajax({
            url: '@Url.Action("GenerateCategorizedQuestions")',
            cache: false,
            dataType: "JSON",
            data: { category: category },
            success: function (data) {
                initializeCategorizedQuestions(data);
            }
        });

        startExam();

        return false;
    });

    // załadowanie listy z pytaniami ogólnymi
    function initializeTrafficQuestions(data) {
        trafficQuestions = data;
        console.log(trafficQuestions);
    }

    // załadowanie listy z pytaniami specjalnymi
    function initializeCategorizedQuestions(data) {
        categorizedQuestions = data;
        console.log(categorizedQuestions);
    }

    function startExam() {
        nextStage();
    }

    // sprawdzenie które pytanie ładujemy
    // jeżeli trwa faza pytań specjalistycznych ładujemy pytanie z tablicy pytań specjalistycznych
    function nextStage() {
        if (trafficQuestionCounter < 20) {
            console.log(trafficQuestionCounter);

            loadQuestion(trafficQuestions[trafficQuestionCounter]);            
            trafficQuestionCounter += 1;

            let trafficProgress = document.getElementById('trafficProgress');
            trafficProgress.innerText = trafficQuestionCounter;
        }
        else {
            let categorizedProgress = document.getElementById('categorizedProgress');
            categorizedProgress.innerText = categorizedQuestionCounter + 1;

            loadQuestion(categorizedQuestions[categorizedQuestionCounter]);
            categorizedQuestionCounter += 1;
        }
    }

    // załadowanie pytania (pierwszego lub kolejnego)
    function loadQuestion(data) {
        let question = document.querySelector('.exam-question');
        question.innerText = data.Question;

        let examScore = document.getElementById('examScore');
        examScore.innerText = data.Score;

        let examPicture = document.querySelector('.exam-picture');
        examPicture.src = data.MediaPath;
    }
</script>